<?xml version="1.0"?>

<language root="bnf">
  
  <!--Non-Terminals-->
  <non-terminal name="bnf">
      <sequence>
        <choice>
          <symbol name="production"/>
          <symbol name="comment"/>
        </choice>
        <sequence min-occurs="0" max-occurs="unbounded">
          <symbol name="new-line" max-occurs="unbounded"/>
          <choice min-occurs="0" max-occurs="1">
            <symbol name="production"/>
            <symbol name="comment"/>
          </choice>
        </sequence>
      </sequence>
  </non-terminal>

  <non-terminal name="production">
    <sequence>
      <symbol name="symbol"/>
      <symbol name="whitespace"/>
      <symbol name="rewrite-op"/>
      <symbol name="whitespace"/>
      <symbol name="rule"/>
    </sequence>
  </non-terminal>

  <non-terminal name="rule">
    <choice>
      <symbol name="literal"/>
      <symbol name="pattern"/>
      <sequence>
        <symbol name="symbol-expression"/>
        <symbol name="recognition-threshold"/>
      </sequence>
    </choice>
      
  </non-terminal>

  <non-terminal name="symbol-expression">
    <sequence>
      <choice>
        <symbol name="symbol-ref"/>
        <symbol name="grouping"/>
      </choice>
      <symbol name="cardinality"/>
    </sequence>
  </non-terminal>

  <non-terminal name="symbol-ref">
    <sequence>
      <symbol name="symbol"/>
    </sequence>
  </non-terminal>

  <non-terminal name="grouping">
    <choice>
      <symbol name="choice"/>
      <symbol name="set"/>
      <symbol name="sequence"/>
    </choice>
  </non-terminal>

  <non-terminal name="choice">
    <sequence>
      <symbol name="q-mark"/>
      <symbol name="ls-brace"/>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="symbol-expression"/>
      <sequence min-occurs="0" max-occurs="unbounded">
        <symbol name="whitespace"/>
        <symbol name="symbol-expression"/>
      </sequence>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="rs-brace"/>
    </sequence>
  </non-terminal>

  <non-terminal name="set">
    <sequence>
      <symbol name="hash"/>
      <symbol name="ls-brace"/>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="symbol-expression"/>
      <sequence min-occurs="0" max-occurs="unbounded">
        <symbol name="whitespace"/>
        <symbol name="symbol-expression"/>
      </sequence>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="rs-brace"/>
    </sequence>
  </non-terminal>

  <non-terminal name="sequence">
    <sequence>
      <symbol name="plus"/>
      <symbol name="ls-brace"/>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="symbol-expression"/>
      <sequence min-occurs="0" max-occurs="unbounded">
        <symbol name="whitespace"/>
        <symbol name="symbol-expression"/>
      </sequence>
      <symbol name="whitespace" min-occurs="0"/>
      <symbol name="rs-brace"/>
    </sequence>
  </non-terminal>

  <non-terminal name="literal">
    <choice>
      <symbol name="case-sensitive" />
      <symbol name="case-insensitive" />
    </choice>
  </non-terminal>

  <non-terminal name="case-sensitive">
    <sequence>
      <symbol name="quote"/>
      <!--this is a terminal regex that describes escapable strings that lie between the " symbol. -->
      <symbol name="case-literal" min-occurs="0"/>
      <symbol name="quote"/>
    </sequence>
  </non-terminal>

  <non-terminal name="case-insensitive">
    <sequence>
      <symbol name="squote"/>
      <!--this is a terminal regex that describes escapable strings that lie between the ' symbol. -->
      <symbol name="non-case-literal" min-occurs="0"/>
      <symbol name="squote"/>
    </sequence>
  </non-terminal>

  <non-terminal name="pattern">
    <sequence>
      <symbol name="fslash"/>
      <!--this is a terminal regex that describes escapable strings that lie between the / symbol. -->
      <symbol name="pattern-literal" min-occurs="0"/>
      <symbol name="fslash"/>
      <symbol name="match-cardinality"/>
    </sequence>
  </non-terminal>

  <non-terminal name="match-cardinality">
    <sequence>
      <symbol name="cardinality"/>
    </sequence>
  </non-terminal>

  <non-terminal name="cardinality"> <!-- this is a good place to set a threshold of 1, can also be used to test the feature-->
    <sequence min-occurs="0" max-occurs="1">
      <symbol name="dot"/>
      <symbol name="digits"/>
      <sequence min-occurs="0" max-occurs="1">
        <symbol name="comma"/>
        <symbol name="digits" min-occurs="0" max-occurs="1"/>
      </sequence>
    </sequence>
  </non-terminal>

  <non-terminal name="recognition-threshold">
    <sequence min-occurs="0" max-occurs="1">
      <symbol name="r-chevron"/>
      <symbol name="digits"/>
    </sequence>
  </non-terminal>

  <non-terminal name="rewrite-op">
    <choice>
      <symbol name="assign"/>
      <symbol name="arrow"/>
    </choice>
  </non-terminal>

  <!-- Terminals-->
  <pattern
    name="symbol"
    regex="^\$[0-9a-zA-Z_][\w-]*$"
    min-match="2"
    max-match="unbounded"/>

  <pattern
    name="whitespace"
    regex="^[ \t]+$"
    min-match="1"
    max-match="unbounded"/>

  <!-- Recognizes the escape &quot; = ", &amp; = &-->
  <pattern
    name="case-literal"
    regex="^[^&quot;]*$"
    min-match="1"
    max-match="unbounded"/>

  <!-- Recognizes the escape &apos; = ', &amp; = &-->
  <pattern
    name="non-case-literal"
    regex="^[^']*$"
    min-match="1"
    max-match="unbounded"/>
  
  <!-- Recognizes the escape &sol; = /, &amp; = &-->
  <pattern
    name="pattern-literal"
    regex="^[^/]*$"
    min-match="1"
    max-match="unbounded"/>

  <pattern
    name="new-line"
    regex="^(\r\n|\r|\n)$"
    min-match="1"
    max-match="2"/>

  <pattern
    name="digits"
    regex="^\d+$"
    min-match="1"
    max-match="2"/>

  <pattern
    name="comment"
    regex="^\#[^\n\r]*$"
    min-match="1"
    max-match="unbounded"/>

  <literal
    name="comma"
    value=","/>

  <literal
    name="assign"
    value="::="/>

  <literal
    name="arrow"
    value="->"/>

  <literal
    name="q-mark"
    value="?"/>

  <literal
    name="fslash"
    value="/"/>

  <literal
    name="plus"
    value="+"/>

  <literal
    name="hash"
    value="#"/>

  <literal
    name="squote"
    value="'"/>

  <literal
    name="quote"
    value="&quot;"/>

  <literal
    name="r-chevron"
    value="&gt;"/>

  <literal
    name="ls-brace"
    value="["/>

  <literal
    name="rs-brace"
    value="]"/>

  <literal
    name="dot"
    value="."/>
  
</language>